# Магазин книг

Контроллеры разделены на две директории:

-   _API_: сам магазин
-   _Admin_: админка на _blade_ + _tailwind_ + _js_.

Аутентификация реализована с помощью _Sanctum_ и разделена для двух моделей:

-   _User_ для сотрудников магазина, имеющих доступ в админку.
-   _Client_ для покупателей.

Обработка исключений из контроллеров вынесена в отдельный слой, в глобальный обработчик _Handler.php_.
Создано кастомное исключение для описания ошибок бизнес-логики: _BusinessException.php_

---

## Сущности

Для всех сущностей валидация запросов проходит в _FormRequest_ классах.
В ответах API выдается _Resource_.

Для некоторых сущностей сделаны _DTO_.

Сервисный слой представлен в виде _Service_ классов для каждой сущности.

Тип обложки и рейтинг продукт, а так же статус заказа и роли описаны в виде _Enum_.

Для тестового заполениня БД описаны _Factory_.

### **Product**

Товар в магазине(книга).

У книги может быть несколько авторов. Принадлежит к книжной серии.
К одному товару можно загружать несколько изображений.

Клиенты могут оставлять текстовый отзыв, в котором так же проставляют рейтинг от 1 до 5.
К отзыву можно писать комментарии и ставить лайки.

### **Category**

Категория с книгами.  
Реализовано в виде _nested sets_.

### **Client**

Клиента магазина, покупатель.
Может помещать товары в корзину и оформлять заказ.

### **User**

Сотрудник магазина, пользователь админки.
Принадлежит к одной из трех ролей:

-   _admin_ - может все
-   _manager_ - работает с товарами, заказами и клиентами
-   _moderator_ - работает с отзывами и комментариями

### **Role**

Роль для сотрудника магазина. Описано выше.
Права и ограничения реализованы с помощью политик.

### **Rewiew**

Отзыв клиента на товар.
При написании обязательно проставляется рейтинг в виде оценки от 1 до 5.

На отзыв можно писать коммента и ставить лайки.

### **Comment**

Комментарий к отзыву и к другому комментарию.
Могут писать не только клиенты, но и сотрудники магазина.

Реализован в виде полиморфной связи с _User/Client_, а также с _Rewiew/Comment_.
Удаление в виде _soft delete_.

### **Like**

Лайк может ставить клиент на отзыв другого клиента.

### **Author**

Автор, many-to-many с книгами.

### **Publisher**

Издатель. Может иметь много книжных серий.

### **Series**

Книжная серия, принадлежит издателю и имеет много книг.

### **Tag**

Тег, просто тег.

### **Image**

Изображение товара.
Из админки можно загружать несколько изображений для одного товара.

### **Cart**

Корзина клиента.
Сохраняется в БД. Состоит из отдельных items, каждый из которых описывает товар в корзине.

### **Order**

Заказ клиента.
Формируется по корзине клиента.
В процессе формирования уменьшается количество товара в магазине.

Имеет один из следующих статусов:

-   _Оформлен_
-   _Ожидает отправки_
-   _Отправлен_
-   _Доставлен_
-   _Завершен_
-   _Отменен_
